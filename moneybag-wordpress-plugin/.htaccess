# Disable directory browsing first
Options -Indexes

# Set DirectoryIndex to use index.php
DirectoryIndex index.php

# Prevent direct access to plugin files
<IfModule mod_authz_core.c>
    # Apache 2.4+
    <FilesMatch "\.(php|inc|log|lock)$">
        Require all denied
    </FilesMatch>
    # Allow main plugin file
    <Files "moneybag-plugin.php">
        Require all granted
    </Files>
    # Allow all index.php files (for directory protection)
    <FilesMatch "^index\.php$">
        Require all granted
    </FilesMatch>
</IfModule>

<IfModule !mod_authz_core.c>
    # Apache 2.2
    <FilesMatch "\.(php|inc|log|lock)$">
        Order deny,allow
        Deny from all
    </FilesMatch>
    <Files "moneybag-plugin.php">
        Order allow,deny
        Allow from all
    </Files>
    # Allow all index.php files (for directory protection)
    <FilesMatch "^index\.php$">
        Order allow,deny
        Allow from all
    </FilesMatch>
</IfModule>

# Block access to sensitive files but allow data JSON files
<FilesMatch "^(.*\.(log|md|git|lock)|package\.json|composer\.)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Allow access to data directory JSON files
<FilesMatch "^(merchant-registration-options|pricing-rules)\.json$">
    Order allow,deny
    Allow from all
</FilesMatch>